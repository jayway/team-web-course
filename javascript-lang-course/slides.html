<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">

        <title>Javascript</title>

        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <style type="text/css">
      .present {
        margin-top: 50px;
      }
      @font-face {
        font-family: "Lato";
        src: url(../html-css-course/resources/Lato/Lato-Regular.ttf) format("truetype");
      }
    </style>
        <link rel="stylesheet" href="../reveal.js/css/main.css">
        <link rel="stylesheet" href="../reveal.js/css/theme/default.css" id="theme">

        <!-- For syntax highlighting -->
        <link rel="stylesheet" href="../reveal.js/lib/css/zenburn.css">


    <!-- Stylesheet -->
    <link href="libs/sandbox.css" rel="stylesheet"/>

        <script>
            // If the query includes 'print-pdf' we'll use the PDF print sheet
            document.write( '<link rel="stylesheet" href="../reveal.js/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
        </script>


    <!-- Templates -->

    <!-- The sandbox template: -->
    <script type="text/template" id="tplSandbox">
        <pre class="output"></pre>
        <div class="input">
            <textarea rows="1" placeholder="<%= placeholder %>"></textarea>
        </div>
    </script>

    <!-- The command/result template (NB whitespace/line breaks matter inside <pre> tag): -->
    <script type="text/template" id="tplCommand"><% if (! _hidden) { %><span class="command"><%= command %></span>
<span class="prefix"><%= this.resultPrefix %></span><span class="<%= _class %>"><%= result %></span>
<% } %></script>


    <!-- Scripts -->

    <!-- Underscore, Backbone, backbone-localStorage, jQuery -->
    <script src="libs/underscore.min.js"></script>
    <script src="libs/backbone.min.js"></script>
    <script src="libs/backbone-localStorage.min.js"></script>
    <script src="libs/jquery.min.js"></script>

    <!-- The JS Sandbox Console script (requires underscore, backbone and jquery): -->
    <script src="libs/sandbox-console.js"></script>

    <!-- When ready, create the model and view -->
    <script type="text/javascript">
        jQuery(document).ready(function($) {
            $('.sandbox').each(function(i, el) {
                new Sandbox.View({
                    el : $(el),
                    model : new Sandbox.Model({
                        iframe : false,  // evaluate commands inside a hidden iframe (default: false)
                        fallback : true // use global eval if iframe isn't available (default: true)
                    })
                });
            });
        });
    </script>


        <!--[if lt IE 9]>
        <script src="../reveal.js/lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>

        <div class="reveal">

            <!-- Used to fade in a background when a specific slide state is reached -->
            <div class="state-background"></div>


            <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">

        <section>
          <h1>JavaScript</h1>
          <p>Jayway Course</p>
          <p>
          <br>
          </p>
        </section>

        <section>
          <h2>Why JavaScript?</h2>
          <div>It's everywhere!</div>
        </section>

        <section>
            <section data-markdown>
                # History
            </section>

            <section data-markdown>
                ## LiveScript/Mocha - 1994-95

                *  Developed by Brendan Eich at Netscape
                * Intended as a light-weight Java-alternative
            </section>
            <section data-markdown>
                ## JavaScript, 1995-96</h2>

                * Included in Netscape Navigator 2.0
                * Included in Microsoft IE 3.0, 1996
                * (MS later renamed it <b>JScript</b>)
                * Standardized as <b>ECMAScript</b>, 1997
            </section>

            <section data-markdown>
                ## History, 2000-

                * ECMAScript goes up to revision 5</p>
                * Browser vendors race for highest performance
                * Google Chrome comes out in 2008 (V8)
                * Enables high performance apps like node.js
                * Many JavaScript engines still in heavy development today
            </section>

            <section data-markdown>
                # ECMAScript and JavaScript

                * "JavaScript" is an ECMAScript variant managed by Mozilla.
                * All non-Mozilla implementations using JavaScript are implementing ECMAScript, rather than Javascript.

            </section>

        </section>

        <section data-markdown>
          Agenda
          ------

          * Installation
          * Values and Control Structures
          * Functions and Scope
          * Objects and Prototypes
          * Good Practices and Gotchas
          * Exercises

        </section>

        <section>
        <section data-markdown>
            ## Installation
        </section>

        <section data-markdown>
            ### Shells for the Exercises

            * The embedded one in this presentation
            * Chrome Dev Tools (CMD-ALT-I)
            * Firefox Scratch Pad (for windows)
        </section>

        <section data-markdown>
            ### Chrome Dev Tools
            See [install instructions](http://jayway.github.com/team-web-course/javascript-lang-course/install/index.html)
            
            ### FireFox Scratch Pad
            See [install instructions](http://jayway.github.com/team-web-course/javascript-lang-course/install/firefoxScratchpad.html)

        </section>


        <section data-markdown>
            ### Alternatives
            * The browser console
            * Firefox scratchpad
            * [http://www.jsconsole.com](http://www.jsconsole.com)
            * Mozilla's Spidermonkey

                   `brew install spidermonkey;
                    js -i`
            * Node.js

                   `brew install node;
                   node`
        </section>
        </section>

        <section>
        <section data-markdown>
            ## Basics
        </section>

        <section data-markdown>
            ### Whitespace

            Use semicolon! (unless you know what you are doing :)

                a = b + c
                (d + e).foo()

                // Treated as:
                a = b + c (d + e).foo();
        </section>

        <section data-markdown>
            ### Variable

                var x;  // declared but not defined

                var y = 0;

                z = 1; // always global scope DON'T !

        </section>

        <section data-markdown>
            ### Function Scope

                function a() { v1 = 42 }  // DON'T !
                a();
                v1 // => 42  GLOBAL

                function b() { var v2 = 43 }
                b();
                v2 // => "ReferenceError: v2 is not defined"

                var v3;
                function c() { v3 = 44 }
                c();
                v3 // => 44

        </section>

        <section data-markdown>
            ### No Block Scope

                var z = 4;

                if (true) {
                    var z = 5;
                }

                z; // => 5

        </section>

        <section data-markdown>
            ### Arithmetic Operators
            +, -, *, /, %, ++, --

            ### Assignment Operators
            =, +=, -=, *=, /=, %=

            ### Comparison Operators
            ==, ===, !=, !==, <, >, >=, <=
        </section>


        <section data-markdown>
            ### Equality and Identity

            == does type coercion (AVOID)

            === does **NOT** do type coercion

                //because 'true' is converted to 1 and then compared
                true == 1; // true

                //because 2 is converted to "2" and then compared
                "2" == 2; // true

                // Using the === operator (Identity)
                true === 1 //false
                "2" === 2 // false

        </section>
        </section>

        <section>

        <section data-markdown>
            ## Control Statements
        </section>
        <section data-markdown>
            ### Control Statements, if, for ...

            * C/Java Style:
              * if, else if, else, while, do while, switch, case, for, continue, break
            * Exceptions: try, catch, finally, throw

            _(see details, arrow down on this slide)_
        </section>

        <section data-markdown>
            ### if else if else

                if (a === b) {
                   "a equals b";
                } else if (a === c) {
                   "a equals c";
                } else {
                   "a does not equal either b or c";
                }

            Or

                a === b ? "a equal b" : "a not equal b"
        </section>

        <section data-markdown>
            ### while

                while (c < 10) {
                   c += 1;
                   // ...
                }
        </section>

        <section>
            <h3>do... while</h3>
<pre><code>
do {
  c += 1;
} while (c < 10)
</code></pre>
        </section>


        <section data-markdown>
            ### switch

                switch(i) {
                  case 1:
                     // ...
                     break;
                  case 2:
                     // ...
                    break;
                  default:
                    // ...
                  break;
                }

        </section>

        <section data-markdown>
            ### for in

                var tapir = { kind: 'Baird', name: 'Vlasek' };
                for (var key in tapir)
                   console.log(key + ' ' + tapir[key])


        </section>

        <section data-markdown>
            ### for

                var myStringArray = ["Hello","World"];
                for (var i = 0; i < myStringArray.length; i++)
                   show(myStringArray[i]);


        </section>

        <section data-markdown>
            ### break

                for (i=0;i<10;i++) {
                   if (i==3) break;
                   x=x + "The number is " + i + "<br />";
                }

        </section>


        <section data-markdown>
            ### continue

                for (i=0;i<=10;i++) {
                   if (i==3) continue;
                   x=x + "The number is " + i + "<br />";
                }
        </section>


        <section data-markdown>
            ### try catch finally

                try{
                  undefinedfunction();
                  alert('I guess you do exist');
                }
                catch(e){
                  alert('An error has occurred: '+e.message);
                }
                finally{
                  alert('I am alerted regardless of the outcome above');
                }

        </section>


        <section data-markdown>
            ### Throw

                throw "Oops" // no stack trace

                throw new Error("Ooops") // now with stack trace

                throw {
                   name: exceptionName,
                   message: reason
                }


        </section>

           <section>
            <h3>Exercise</h3>
            <div class='sandbox-notes'>
              <h5>for loop</h5>
            Impl. function 'sum' using a <code>for</code> loop so that:
<pre><code>
sum([1,2,3]) # => 6
sum([]) #=> 0
</code></pre>
              Hint: <pre><code>
function sum(v) {
  var total = 0;
  // for ...;
  //  total += v[i];
  return total;
}
</code></pre>

</div>
           <div class="sandbox">sandbox console loading...</div>

        </section>
        <section>
                      <h3>Solution</h3>

<pre><code>
function sum(v) {
  var total = 0;
  for (var i=0; i < v.length; i++) {
      total += v[i];
  }
  return total;
}
</code></pre>
</section>
           </section>

           <section>

        <section data-markdown>
            ## Values
        </section>

        <section data-markdown>
            ### Values
            * Numbers
            * Strings
            * Booleans
            * Object
            * null
            * undefined
            * Arrays (object)
            * Regular Expressions (object)
            * Functions (object)
        </section>


        <section data-markdown>
            ### Strings

                // example:
                var txt  = 'Hello World!';
                var txt2 = "I'm happy" + " happy";

            _Sequence of 16 bit elements interpreted as UTF-16._

        </section>

        <section data-markdown>
            ### String Methods

            charAt, concat, indexOf, lastIndexOf, match, replace, search, slice, split, substring, toLowerCase, toUpperCase

        </section>


        <section>
        <section data-markdown>
            Numbers
            -------

            _Represents both integers and reals. 64 bit._

                var a = 352661;
                var b = 334.22;

            Special values:

                NaN
                +Infinity
                -Infinity

        </section>

        <section data-markdown>
            ### Numbers

                test("Strange arithmetic", function() {
                    var a = NaN;
                    equals( a &lt;  10, false, "bigger than 10");
                    equals( a &gt;  10, false, "smaller than 10");
                    equals( a === 10, false, "not equal to 10");
                    equals( a === NaN, false, "not NaN??? " );
                    equals( isNaN( a ), true, "Ahh!!" );
                });


            _Caveat: some operators only work on 32 bit numbers. A silent conversion
            will be performed by the operator._
        </section>

        </section>

        <section data-markdown>
            ### String to Number

            parseInt, parseFloat and Number:

                parseInt("1234blue"); //returns 1234
                parseInt("0xA"); //returns 10
                parseInt("22.5"); //returns 22
                parseInt("blue"); //returns NaN
                parseInt("09"); // return 0 !!!
                parseInt("09",10); // return 9 !!!
                parseFloat("1234blue”); //returns 1234.0
                parseFloat("0xA”); //returns NaN
                parseFloat("22.5”); //returns 22.5

                Number('42.0') // returns 42
        </section>

        <section data-markdown>
            ### Number to String

                var num = 15;
                num.toString();

                // or
                15 + "";

                // or
                String(15);
        </section>


        <section data-markdown>
            ### Booleans

                //Two possible values: true or false
                var a = true;
                var b = a &amp;&amp; ( a == false );

        </section>

        <section data-markdown>
            ### Falsy values

            * false
            * null
            * undefined
            * ""
            * 0
            * NaN

            _All other values are truthy_

        </section>

        <section data-markdown>
            ### undefined and null

            `undefined` - Anything unassigned or not declared.

            `null` - meaning "no value".

        </section>

        <section data-markdown>
            ### undefined and null

            `undefined` - variable has not been declared or has not been given a value.

                var input;
                if(input === undefined) {
                    doThis();
                } else {
                    doThat();
                }

        </section>

        <section data-markdown>
            Equality and Comparison
            -----------------------

            '==' can produce confusing results

                equals( false, '' == '0' );
                equals( true, 0 == '' );
                equals( true, 0 == '0' );

                equals( false, false == 'false' );
                equals( true, false == '0' );

                equals( false, false == undefined );
                equals( false, false == null );
                equals( true, null == undefined );

                equals( true, ' \t\r\n ' == 0 );

        </section>


        <section>
            <h3>Exercise <code>typeof</code></h3>

            <div class='sandbox-notes'>
                <ul>
                    <li>What type does null have ? hint: <code>typeof null</code></li>
                <li> What type does an unknown variable have?<br/>hint: <code>typeof notDeclaredVar</code></li>
                </ul>
            </div>
           <div class="sandbox">sandbox console loading...</div>
        </section>


        <section>
            <h3>Exercise Equality</h3>
            <div class='sandbox-notes'>
                Explore:
                <ul>
                    <li><code>'x' == new String('x')</code></li>
                    <li><code>'x' === new String('x')</code></li>
                    <li><code>null == undefined</code></li>
                    <li><code>null === undefined</code></li>
                    <li><code>undefined || 'Hello'</code></li>
                    <li><code>'' || 'Hello'</code></li>
                    <li><code>"Hello " + undefined + 2</code></li>
                </ul>
            </div>

           <div class="sandbox">sandbox console loading...</div>
        </section>
        </section>

        <section>
        <section data-markdown>
            ## Functions


        </section>
        <section data-markdown>
            ### First Class Object

            means

            * Can be stored in variables and properties
            * Can be arguments to functions
            * Can be returned from functions

        </section>


        <section data-markdown>
            ### Function Statement

                function foo() {}

            expands to

                var foo = function foo() {};

        </section>

        <section>
            <h3>Exercise</h3>

            <div class='sandbox-notes'>
              <h5>Function and parseInt</h5>
<div class="text">Write a function <code>add</code> that adds two string values like this:</div>
<p class="text"><code>add("42", "3") // => 45</code></p>
            </div>
           <div class="sandbox">sandbox console loading...</div>
        </section>

        <section data-markdown>
           ### Solution

                  function add(val1, val2) {
                     return parseInt(val1, 10) + parseInt(val2, 10);
                  }
        </section>

        <section data-markdown>
            ## Anonymous Functions

                var f = function(a, b) { return a + b; }
        </section>

        <section data-markdown>
            ### Invocation

            by parenthesis

                //Example:
                var greeter = function() { return 'hello'; }

                greeter // a reference to the function
                greeter() // => 'hello'

            also possible, direct invokation

                function() { return "hello";}();
        </section>

        <section data-markdown>
            ### Arguments

            * `arguments` is a magic property, like `this`.
            * The `arguments` of the invocation.
            * An array *like* structure.
                * Not a real array

                <pre><code class='javascript'>// To use array methods arguments, use apply
                Array.prototype.join.apply(arguments, '-');</code></pre>

            `apply` will be explained later.

        </section>

        <section data-markdown>
            ### Arguments

            Arguments are optional

                // missing arguments will be undefined
                function foo(x, y) { return x + y }
                foo('COOL')  # => ’COOLundefined’

            `arguments` are always present.

                function bar(x, y){ return arguments;}
                bar("hej", 42) // => [ "hej", 42 ]

        </section>

          <section>
            <h3>Exercise</h3>

            <div class='sandbox-notes'>
<h4>Undefined arguments</h4>
<pre><code>
// define this function:
y = "hoj";
function things(x,y,z) {
  return x + y + z;
}

</code></pre>
What does the following statement return ?
<ul>
<li><code>things("one")</code> </li>
<li><code>things("one", "two", "three", "four")</code> </li>
</ul>
              </div>
           <div class="sandbox">sandbox console loading...</div>
        </section>

        <section data-markdown>
           ## Solution
           * things("one")
           <code>=> "oneundefinedundefined"</code>

           * things("one", "two", "three", "four")</br>
           <code>=> "onetwothree"</code>
           </section>

          <section>
            <h3>Exercise</h3>

            <div class='sandbox-notes'>
<h4>Variable Arguments</h4>
Create a varargs version of the <code>things</code> method from
previous exercise. It should allow to append three string values.
<pre><code>
function things() { ... }
things("one"); // => // "oneundefinedundefined"
things("one", "two"); // => "onetwoundefined"
things("one", "two", "three"); "onetwothree"
</code></pre>

              </div>
           <div class="sandbox">sandbox console loading...</div>
        </section>
           <section>
            <h3>Solution</h3>
               <pre><code class="javascript">
function things() {
  return arguments[0] + arguments[1] + arguments[2];
}
</code></pre>
           </section>

       <section data-markdown>
            ### Returning Functions

                var greeter = function(greeting) {
                  return function(name) { return greeting + " " + name; }
                };

                // Create a function
                var howdy = greeter('Howdy');

                // Invoke it
                howdy('Andreas'); // => "Howdy Andreas"

                // Direct invocation
                greeter('How')('Tapir'); //How Tapir
        </section>

        <section>
            <h3>Exercise</h3>

            <div class='sandbox-notes'>
                Write an anonymous function so that:
                <pre><code>
var x = function()...
x;  // => "Your Name"
x(); // => "TypeError, ... not a function"
               </code></pre>
            </div>

           <div class="sandbox">sandbox console loading...</div>
        </section>

        <section>
           <h3>Solution</h3>
                <pre><code>
var x = function() { return "Andreas"; }()

               </code></pre>
        </section>
    </section>

        <section>
        <section data-markdown>
            ## Arrays
        </section>
        <section data-markdown>
            ## Arrays

            * Array inherits from object!
            * Indexes are converted to strings
            * `length` = One more than the largest numeric index.
            * The `length` property can be set!
            * When you add a new element, `push()`, length is increased by one.
        </section>

        <section data-markdown>
            ## Arrays

            * `var names = ['a', 42, false]`
            * `typeof names == ‘object’`
            * `names.constructor === Array`
        </section>

        <section data-markdown>
            ### Example
                var v = ['foo', 42, false];
                v.length = 2;
                v.foo = 'bar'
                v; // => ['foo', 42]
                v[0]; // 'foo'
        </section>

        <section data-markdown>
            ## Array Methods

            * `concat`, `join`, `pop`, `push`, `slice` , `sort`, `splice`, `length`
            * ECMAScript 5 (IE 9)
               * `forEach`, `indexOf`, `lastIndexOf`, `filter`, `map`, `every`, `some`, `reduce`, `reduceRight`
        </section>

        <section data-markdown>
            ## Array map
            Syntax: `array.map(callback[, thisArg])`
            Example:

                 // ECMAScript 5
                 var numbers = [1, 4, 9];
                 var roots = numbers.map(Math.sqrt);
                 /* roots is now [1, 2, 3], numbers is still [1, 4, 9] */
        </section>

            <section>
                <h3>Exercise</h3>
                <div class='sandbox-notes'>
                    <h5>Array's map method</h5>
                    a) Finish the line so that:
<pre><code>
"1,2,3".split(',').map(...)
</code></pre>
                    returns [2,4,6]<br>

                    b) Write a line so it returns it as a string "2,4,6" (hint use <code>join</code>)

                </div>
                <div class="sandbox">sandbox console loading...</div>

            </section>

            <section>
                <h3>Solution</h3>
<pre><code>
"1,2,3".split(',').map(function(x){return 2*parseInt(x,10)}).join();
</code></pre>

            </section>

        <section data-markdown>
          ### Array Reduce

          **Syntax**: array.reduce(callback[, initialValue])

          **Callback Args**: ack, curr, index, array

          #### Description

          * Executes the callback once for each element
          * `ack` - the initial value or the return value from previous callback
          * `curr` - the current value in the array
          * `index`, `array` - optional
        </section>

        <section>
            <h3>Exercise</h3>
            <div class='sandbox-notes'>
                <h5>Array's reduce method</h5>
                What does the following line return and why ?

<pre><code>
['cat', 'elephant', 'tapir'].reduce(function(ack, curr) {
  return (ack.length > curr.length) ? ack : curr;
});
</code></pre>
            </div>
            <div class="sandbox">sandbox console loading...</div>
        </section>

           <section>
            <h3>Exercise</h3>
            <div class='sandbox-notes'>
              <h5>Array's reduce method</h5>
            Impl. function 'sum' using the Array <code>reduce</code> method so that:
<pre><code>
sum([1,2,3]) # => 6
sum([]) #=> 0
</code></pre>
Hint <code>[].reduce(function(prev, curr),firstVal){...}</code>

</div>
           <div class="sandbox">sandbox console loading...</div>

        </section>

        <section>
                      <h3>Solution</h3>
<pre><code>
function sum(v) {
  return v.reduce(function(prevValue, currValue) {
     return prevValue + currValue;
  }, 0)
}

// Much nicer than using a loop, isn't it !
// Notice, only available in ECMAScript 5
// underscore.js has similar method:
// _.reduce(list, iterator, memo, context)
</code></pre>

</section>

        <section data-markdown>
            ### underscore.js library

            Examples: `map`, `filter`, `once`

                _.map([1, 2, 3], function(num){ return num * 3; });
                // => [3, 6, 9]

                var even = _.filter([1, 2, 3, 4, 5, 6], function(num){
                  return num % 2 == 0;
                });  // => [2, 4, 6]

                var initialize = _.once(createApplication);
                initialize();
                initialize(); // Application is only created once.
        </section>

        <section>
            <h3>Exercise</h3>

            <div class='sandbox-notes'>
            <h5>Function arguments</h5>
            Impl. function <code>each(array, f)</code> the function should call
            function f for every element of the array.
<pre><code>
var total = 0;
each([1,2,3], function(q) {
    total += q;
});
total # => 6
</code></pre>

Hint: use a <code>for</code> loop. <br/>

</div>
           <div class="sandbox">sandbox console loading...</div>

        </section>

        <section>
           <h3>Solution</h3>
<pre><code>
function each(v,f) {
    for (var i=0; i < v.length; i++) {
        f(v[i]);
    }
}
</code></pre>
        </section>

        <section>
            <h3>Exercise</h3>
            <div class='sandbox-notes'>
            <h5>Recursion</h5>
            Impl. function <code>times(n, f)</code> it should call f n times.
            Bonus points for using recursion.

           <pre><code>
var total = 0;
times(10, function() {
    total += 1;
})
total // => 10
</code></pre>
</div>
           <div class="sandbox">sandbox console loading...</div>

        </section>

       <section>
           <h3>Solution</h3>
<pre><code class="javascript">
function times(n,f) {
  if (n > 0) {
     f();
     times(n-1, f);
  }
}
total = 0;
    total += 1;
})
total // => 10
</code></pre>
        </section>
        </section>

        <section>
        <section data-markdown>
            ## Objects
        </section>

        <section data-markdown>
            ### Objects

            An object is a container of keys and values.

                var myObject = {
                   name: 'Andreas',
                   sayHello: function() {... }
                }


            Similar to JSON
        </section>


    <section>
        <h3>Retrieval</h3>
            <pre><code>
var flight = {
  airline: "Oceanic",
  departure : {
    IATA: "SYD",
    time: "2004-09-22 14:55",
    city: "Sydney"
  }
}
flight.departure.city;
// Same as
flight["departure"]["city"];
            </code></pre>
        </section>

    <section>
        <h3>Object Methods</h3>
            <pre><code>
var myObject = {
  name: 'andreas',
  sayHello: function() { alert("hello") }
}
myObject.sayHello // the function reference
myObject.sayHello();
            </code></pre>
        </section>

    <section>
        <h3>Non-existent properties</h3>
            <pre><code>
flight.foo // undefined
flight['foo'] // undefined
flight.foo.city; // TypeError
            </code></pre>
        </section>

    <section>
        <h3>Setting Non-existent properties</h3>
            <pre><code>
flight.foo = 'bar';
flight['baaz'] = 42
            </code></pre>
        </section>

    <section>
        <h3>Deleting properties</h3>
            <pre><code>
delete flight.foo
flight.foo // undefined
            </code></pre>
        </section>


        <section>
            <h3>Exercise: object method</h3>

            <div class='sandbox-notes'>
              Create an object <code>adder</code> with a method
              <code>add</code> and a property <code>sum</code>

              <p><pre><code>
var adder = { add: function(v) {
    // TODO
}
typeof adder.sum // "undefined"
adder.add(42)
adder.sum // => 42
adder.add(3)
adder.sum // => 45
</code></pre></p>
              Hint: setting property use <code>this.sum = ...</code>
            </div>
           <div class="sandbox">sandbox console loading...</div>
        </section>

        <section>
           <h4>Solution</h4>

<pre><code>
var adder = {
  add: function(val) {
     this.sum = (this.sum || 0) + val;
  }
}
</code></pre>
        </section>



        <section>
           <h3>Constructor Functions</h3>
           <ul>
             <li>function which should be used together with <code>new</code></li>
             <li>by convention first character upper case</li>
           </ul>

                      <pre><code>
function MyFunc() {
  this.name = 'me'
}
new MyFunc();
</code></pre>
        </section>

        <section>
          <section>
            <h3>Exercise 1: Constructor Functions</h3>

            <div class='sandbox-notes'>
Define <br>
<pre><code>function f42() {
    return 42;
}</code></pre><br/>
Question 1: what does <code>f42()</code> return ?<br/>

Question 2: what does <code>new f42()</code> return ?<br/>
            </div>
           <div class="sandbox">sandbox console loading...</div>
         </section>

         <section data-markdown>
           * Answer 1: 42
           * Answer 2: a new object
          </section>
        </section>

        <section>
           <h3>Constructor and This</h3>

           <code>this</code> is set to the new object, example:

           <pre><code>
function MyFunc() {
  this.name = 'me'
}

var myObj = new MyFunc();
myObj.name; // => 'me'
           </code></pre>
        </section>

        <section data-markdown>
            ### The Constructor Functions

                function Pet(species) {
                    this.species = species;
                    this.sayHello = function() {
                      return "Hello " + this.species;
                    }
                 }
                 var cat = new Pet('cat');
                 cat.sayHello();
        </section>

          <section>
            <h3>Exercise: Constructor Functions</h3>

            <div class='sandbox-notes'>
              Write a constructor function so that <pre><code>
function Adder() { // write this... }
var x = new Adder();
x.sum // => 0
x.add(42)
x.add(3)
x.sum // => 45
</code></pre>
              <p/>
              Discuss:<br/>
              When should you use contructor functions?<br/>
              When should you use object literals?
            </div>
           <div class="sandbox">sandbox console loading...</div>
          </section>

          <section>
           <h4>Solution</h4>

<pre><code>
function Adder() {
   this.sum = 0;
   this.add = function(val) {this.sum += val}
}
</code></pre>
          </section>


        </section>

        <section>
        <section data-markdown>
            ## Prototypes
        </section>

        <section data-markdown>
            ### Prototype-based programming

            #### A beautiful thing

            * OO without classes!
            * Inheritance by object delegation

       </section>

        <section>
        <h3>The Prototype Chain</h3>
           Example: bar share foo's properties:
             <pre><code>
var foo = {name: "foo", one: 1, two: 2};
var bar = {two: 'two'};
// Make bar delegate method calls the prototype foo:
bar.__proto__ = foo;  // don't - not standard !
bar.one // Resolves to 1.
bar.two // Resolves to 'two'
delete bar.two
bar.two // Resolves to 2
            </code></pre>
       </section>
           <section>
             <h3>hasOwnProperty</h3>
           Where is the property defined ?
<pre><code>
var base = { hello: function() { return "hello"}}
var sub = { world: "world" }
sub.__proto__ = base; // Don't do this !
sub.hasOwnProperty('world') // => true
sub.hasOwnProperty('hello') // => false
base.hasOwnProperty('hello') // => true
</code></pre>
           </section>

           <section>
           <h3>Getting all props</h3>

<pre><code>
// see definition of sub and base in previous slide
for (var key in sub) {
  console.log(key); // prints world and hello
}

for (var key in base) {
  console.log(key); // prints hello
}
</code></pre>

           <code>hasOwnProperty</code> can be useful here
           </section>


       <section>
         <h3>The prototype property</h3>
         All functions have a 'magic' property: <code>prototype</code>

<pre><code>
var myFunc = function() {};
myFunc.prototype; // what does this do ?
</code></pre>
       </section>


        <section data-markdown>
          <h3>Prototypal Inheritance</h3>

          * Objects can share properties
          * Let F be a function, e.g. `function F() {}`
          * `new F()` creates new objects that inherits from `F.prototype`
          * `F` is a constructor function.
        </section>


        <section data-markdown>
            ### The prototype

            Object's can share properties/functions:

                function Pet(species){
                  this.species = species;
                }

                // all objects created by the Pet constructor
                // will share the sayHello method
                Pet.prototype.sayHello = function() {
                  return "Hello " + this.species;
                }

        </section>

        <section>
            <h3>Exercise: Constructor Functions</h3>

              Why should I use the prototype instead in the following example
<pre><code>
function Pet(species) {
 this.species = species;
 this.sayHello = function() { return "Hello " + this.species; }
}
</code></pre>
        </section>

        <section data-markdown>
            ### The prototype property

            * Is used to share properties
            * Is used for inheritance

        </section>


        <section data-markdown>
            ## Built-in Prototypes

            * Object.prototype
            * Array.prototype
            * Function.prototype
            * Number.prototype
            * String.prototype
            * Boolean.prototype
        </section>

       <section data-markdown>
           ## Extending

               // Avoid doing this !
               Array.prototype.last = function() {
                   return this[this.length - 1];
               };

               [1.2.3].last(); // => 3
        </section>

          <section>
            <h3>Exercise: The Prototype</h3>

            <div class='sandbox-notes'>
<pre><code>
function WhoAmI() {
   this.me = 'not sure';
   this.foo = 42;
}
WhoAmI.prototype = {
  me: "",
  bar: 43
}
var x = new WhoAmI();
// What is x.me, x.foo and x.bar ?
</code></pre>
            </div>

           <div class="sandbox">sandbox console loading...</div>
            </section>

    <section>
        <h3>Object.create</h3>
            <pre><code>
var foo = {name: "foo", one: 1, two: 2};
var bar = Object.create(foo);
bar.one // Resolves to 1.
bar.two // Resolves to 2
            </code></pre>
        </section>

       <section>
        <h3>Prototypal Inheritance</h3>
          <pre><code>
// define a base object
var foo = {
    name: "foo",
    sayHello: function() {
        alert("hello from " + this.name);
    }
};
foo.sayHello();
            </code></pre>
      </section>

       <section>
        <h3>Prototypal Inheritance</h3>
            <pre><code>
var foo = {
    name: "foo",
    sayHello: function() {
        alert("hello from " + this.name);
    }
};

// define an object 'inheriting' from object foo
var bar = Object.create(foo);
bar.sayGoodbye = function() {
    alert("goodbye from " + this.name);
}
bar.sayHello();
bar.sayGoodbye();
            </code></pre>
      </section>

        <section data-markdown>
            <h3>Object.create</h3>

                // Usually built in, but can be implemented like this:
                Object.create = function(o) {
                    function F() {}
                    F.prototype = o;
                    return new F();
                 }
        </section>

        <section>
        <h3>Object.create and Prototype</h3>

<pre><code>
function People() {}
People.prototype = Object.create(Array.prototype)
People.prototype.last = function() { return this[this.length - 1] }

p = new People();
p.push("kalle")
p.push("Sune")
p.last(); // => "Sune"
</code></pre>


        </section>
        <section>
            <h3>Exercise <code>Object.create</code></h3>

            <div class='sandbox-notes'>
              Use : <p><code>var adder = { add: function(val) {
              this.sum = (this.sum || 0) + val; } }</code></p>

              Inherit from <code>adder</code> so that:
              <p>
<pre><code>
var x = // write this line
x.sub = // write this line, so that:
x.add(5);
x.sum // => 5
x.sub(3)
x.sum // => 2
</code></pre>
              </p>
            </div>

           <div class="sandbox">sandbox console loading...</div>
        </section>

        <section>
           <h3>Solution</h3>
<pre><code>
var adder = {
  add: function(val) {
    this.sum = (this.sum || 0) + val;
  }
}
var x = Object.create(adder);
x.sub = function(value) { this.add(-value) }
</code></pre>
        </section>
    </section>

    <section>
        <section data-markdown>
            ## JSON
        </section>

        <section data-markdown>
            ## JSON

            * A subset of Javascript
            * JavaScript Object Notation
                * objects
                * arrays
                * strings
                * numbers
                * booleans
                * null
        </section>

        <section>
            <h3>JSON</h3>
            <pre><code>
            {
                "airline": "Oceanic",
                "number": 815,
                "departure" : {
                    "IATA": "SYD",
                    "time": "2004-09-22 14:55",
                    "city": "Sydney"
                },
                "arrival" : {
                    "IATA" : "LAX",
                    "time" : "2004-09-23 10:42",
                    "city" : "Los Angeles"
                }
            }
            </code></pre>
        </section>

        <section>
            <h3>JSON</h3>
            <pre><code>
                // array of objects
                var array = [
                    {
                        "firstName" : "John",
                        "lastName"  : "Doe",
                        "mobile"    : 2353,
                        "loggedin"  : true
                    },
                    {
                        "firstName" : "Mary",
                        "lastName"  : "Smith",
                        "mobile"    : 3243,
                        "loggedin"  : false
                    }
                ];
            </code></pre>
        </section>
        </section>

        <section>
        <section data-markdown>
            ## Scope

            The function is the scope of variables.
        </section>

        <section data-markdown>
            ## Function Scope

                var iAmGlobal = 42;
                var x = function(){
                   var secret = 1;
                   return iAmGlobal + 1;
                }(); // => 43

                secret // => ReferenceError: secret not defined

        </section>

        <section data-markdown>
            ## This

            `this` depends on who's calling:

                var x = {
                  name: 'andreas',
                  me: function() { return this.name; }
                };

                // Calling an Object's Method:
                x.me(); // => 'andreas'

                var y = x.me
                y(); // => undefined !!!
                this.name = 'root';
                y(); // => 'root'
        </section>

        <section data-markdown>
            ## What is this?

                function test_this() { return this; }

            <table style=''>
                <thead>
                    <tr>
                        <th>Call</th>
                        <th><code>this</code></th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><pre><code>test_this(a)</code></pre></td>
                        <td><code>window</code> (the global object)</td>
                    </tr>
                    <tr>
                        <td><pre><code>tapir.test_this(a)</code></pre></td>
                        <td><code>tapir</code></td>
                    </tr>
                    <tr>
                        <td><pre><code>new test_this(a)</code></pre></td>
                        <td><code>{}</code> (a new object)</td>
                    </tr>
                    <tr>
                        <td><pre><code>test_this.call(dingo, a)</code></pre></td>
                        <td><code>dingo</code></td>
                    </tr>
                    <tr>
                        <td><pre><code>test_this.apply(dingo, [a])</code></pre></td>
                        <td><code>dingo</code></td>
                    </tr>
                </tbody>
            </table>

        </section>

        <section>
            <h3>Event handling</h3>

            <pre><code>
  function click_handler() {
   alert(this); // the DOM element clicked
  }

 &lt;button id='thebutton' onclick='click_handler()'>Click me!</button>
            </code></pre>
<code>this</code> is the DOM element clicked

        </section>

        <section data-markdown>
            ## Call

                 var first_object = {
                  num: 42
                 };
                 var second_object = {
                  num: 24
                 };

                 function multiply(mult) {
                  // 'this' can be changed by using 'call'
                  return this.num * mult;
                 }

                 // set the this reference to first_object
                 multiply.call(first_object, 5); // returns 42 * 5
                 // set the this reference to second_object
                 multiply.call(second_object, 5); // returns 24 * 5
        </section>

        <section data-markdown>
            ## Apply

            Similar to call, but with args as an array:

                multiply.apply(first_object, [5]); // returns 42 * 5
                multiply.apply(second_object, [5]); // returns 24 * 5
        </section>


        <section data-markdown>
          ### JS Frameworks and bind

          * ECMAScript5 - Function.prototype.bind
          * backbone/underscore - `bind`, `bindAll`
               * Example: `_bind(this.render, this)`
               * CoffeeScript, use the <code>=></code> operator

        </section>

        <section>
           <h3>Exercise: this, string, arrays</h3>

           <div class='sandbox-notes'>
            Impl. <code>t</code> which translates strings:
            <pre><code>
var t = { ... }
t.hello = 'hej';
t.world = 'värld';
t.translate("hello world") # => "hej värld"
            </code></pre>
             <p>Use Array methods: <code>map</code>, <code>join</code></p>
             <p>Use String method: <code>split(' ')</code></p>
          </div>
          <div class="sandbox">sandbox console loading...</div>
        </section>

        <section data-markdown>
          ### Solution

          <pre><code>
            var t = {
                translate: function(s) {
                var self = this;
                var reply = [];
                return s.split(' ').map(function(w) {
                   return self[w];
                }).join(' ');
                }
            }
          </code></pre>

              t.hello='hej';
              t.world='varld';

        </section>



           <section>
            <h3>Exercise: Inheritance</h3>

            <div class='sandbox-notes'>
              <pre><code>
var base = { foo: 'bla'};
var sub = Object.create(base);
              </code></pre>
            What happens when
              <pre><code>
base.foo = 'changed'
sub.foo // ??
              </code></pre>
              </div>
          <div class="sandbox">sandbox console loading...</div>
          </section>

        <section data-markdown>
          ### Solution

              base.foo = 'changed' // "changed"
              sub.foo // "changed"
        </section>

        </section>


        <section>
            <section data-markdown>
                ## Eval and Regex
            </section>

        <section data-markdown>
            ## Dynamic Compilation
            * `eval`
                * Evaluates a string and returns the result.
            * `new Function(parameterArray, codeString)`
                * Creates and returns a function.
                * `var add=new Function("a", "b", "return a+b;");`
        </section>

        <section data-markdown>
            ### Regular Expressions

            #### Methods:

            `String.search`, `String.match`, `String.replace`, `String.split`, `RegExp.exec`, `RegExp.test`

            #### Example:

                 var re5digit = /^\d{5}$/; or new RegExp("pattern")
                 "12312".search(re5digit) // # => 0


        </section>
        </section>

        <section>
        <section data-markdown>
            ## Good Practices
        </section>

        <section data-markdown>
            ## Cascade

                setFirst: function(name) {
                  this.first = name;
                  return this;
                }
                person
                .setFirst(“Anders”)
                .setLast(“Janmyr”)
                .setAge(40);
       </section>

        <section data-markdown>
            ## Encapsulation
                // define unless not already defined
                var Esperanto = Esperanto || {};

                // Hide private things in functions
                Esperanto.Lab = function() {
                    var privVar = "example";
                    function privFunc() {
                       return privVar;
                    }
                    // Return the public API
                    return {
                       // Notice, access private function
                       example: function() { return privFunc(); }
                    }
                 }()

                // Usage:
                Esperanto.Lab.example();
                // we can't access privVar or privFunc !
        </section>

        <section data-markdown>
            ### Modules/Encapsulation

            Example of Third Party Libs:

            * RequireJS - file and module loader
            * StealJS - Script & Dependency System and more
            * CommonJS
        </section>

        <section data-markdown>
            ## Local Functions

            <pre><code>
            costData: function(cur) {
                var data = {};
                function addEntry(name, cost) {
                    data[name + "PerHour"] =
                    model.withTwoDec(cost/hours);
                    data[name] =
                    model.noDecimalsWithSeparator(cost);
                };

                addEntry("interest", this.financialCost(cur)),
                addEntry("depreciation", this.depCost(cur)),
                return data;
            },
            </code></pre>
        </section>

        <section data-markdown>
            ## self = this

                attachFormListener: function(form, object) {
                    var self = this;
                    function populator(event) {
                       self.populateFromForm(form, object);
                       object.notify();
                    };

                    form.getElements().each(function(child) {
                       child.observe('change', populator);
                    });
                 }

        </section>

        <section data-markdown>
            ### JavaScript Strict Mode

            * Available ECMAScript 5
            * Throws errors for error prone code.
            * Don't use globally - can break third party libs when concatenating files

            <pre><code>
            // Don't use strict globally
            (function() {
                "use strict";
                // this runs in strict mode
            }());
            </code></pre>
        </section>

        <section>
       <h3>Avoid Callback Spaghetti</h3>

            <pre><code>
step1(function (value1) {
  step2(value1, function(value2) {
    step3(value2, function(value3) {
      step4(value3, function(value4) {
        // Do something with value4
      });
    });
  });
});
            </code></pre>
Use a promise library, e.g. <code>Q.fcall(step1).then(step2).then(step3)</code>

       </section>
        </section>


        <section>
        <section data-markdown>
            ## javascript gotchas
        </section>
        <section data-markdown>
            ### Equality

            Be aware of:

                "1" == 1 // true

            Advice:

                Number("1") === 1

        </section>

        <section data-markdown>
            ### `parseInt` doesn't assume base-10

            Be aware of:

                parseInt("8"); //8
                parseInt("08"); //0

            Advice:

                parseInt("8", 10); //8
                parseInt("08", 10); //8

        </section>


        <section data-markdown>
            ### instanceof

            Be aware of:

                "hello" instanceof String; //false
                new String("hello") instanceof String; //true

        </section>


        <section data-markdown>
            ### instanceof

            Be aware of:

                typeof [1,2,3]  // 'object'
                [1,2,3] instanceof Array // true

        </section>

        </section>

        <section>
        <section data-markdown>
            ## Other stuff
        </section>
        <section data-markdown>
            ### Some Random Advice

            * Javascript strict mode,
            * JSLint, JSHint, <a href="http://jsshaper.org/">jsshaper</a>, Closure Compiler
            * Consider CoffeeScript
            * UglifyJS as preprocessor
            * Learn the Chrome Developer Tool box
            * Test Frameworks (of course !)
        </section>

        <section>
            <h3>CoffeeScript Example</h3>

            <pre><code>
class Animal
  constructor: (@name) ->
  move: (meters) -> alert "#{@name} move #{meters}"
            </code></pre>
        </section>

        <section>
            <h3>Compiles to</h3>

            <pre><code>
(function() {
  var Animal;

  Animal = (function() {

    function Animal(name) {
      this.name = name;
    }

    Animal.prototype.move = function(meters) {
      return alert(this.name + " move " + meters);
    };

    return Animal;

  })();

}).call(this)
            </code></pre>
        </section>


        <section data-markdown>
            ### Mocha Example

                describe('Array', function(){
                  describe('#indexOf()', function(){
                    it('returns -1 when value missing', function(){
                       assert.equal(-1, [1,2,3].indexOf(5));
                       assert.equal(-1, [1,2,3].indexOf(0));
                     })
                   })
                })

            Check also the Jasmine Test Framework
        </section>

        <section data-markdown>
            ### More Exercises

            * See the lab/functional and lab/strings folders
            * Open browser for the tests.html file
            * Impl the .js file to get the tests to pass.
        </section>

        <section data-markdown>
            ### Reading List

            * Javascript, The Good Parts
            * Javascript Patterns
            * Eloquent Javascript, http://eloquentjavascript.net/
            * JavaScript: The Definitive Guide
            * CoffeeScript: http://coffeescript.codeschool.com
            * [Chrome Dev Tools](https://developers.google.com/live/shows/ahNzfmdvb2dsZS1kZXZlbG9wZXJzcg4LEgVFdmVudBiv6NcCDA/)
        </section>
        </section>

      </div>

            <!-- The navigational controls UI -->
            <aside class="controls">
                <a class="left" href="#">&#x25C4;</a>
                <a class="right" href="#">&#x25BA;</a>
                <a class="up" href="#">&#x25B2;</a>
                <a class="down" href="#">&#x25BC;</a>
            </aside>

            <!-- Presentation progress bar -->
            <div class="progress"><span></span></div>

        </div>

        <script src="../reveal.js/lib/js/head.min.js"></script>
        <script src="../reveal.js/js/reveal.min.js"></script>

        <script>

            // Full list of configuration options available here:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                progress: true,
                history: true,

                theme: Reveal.getQueryHash().theme || 'jayway', // available themes are in /css/theme
                transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/linear(2d)

                // Optional libraries used to extend on reveal.js
                dependencies: [
                    { src: '../reveal.js/lib/js/highlight.js', async: true, callback: function() { window.hljs.initHighlightingOnLoad(); } },
                    { src: '../reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: '../reveal.js/lib/js/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: '../reveal.js/lib/js/data-markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: '/socket.io/socket.io.js', async: true, condition: function() { return window.location.host === 'localhost:1947'; } },
                    { src: 'plugin/speakernotes/client.js', async: true, condition: function() { return window.location.host === 'localhost:1947'; } }
                ]
            });

        </script>

    </body>
</html>

<!--  LocalWords:  Impl Ahh fooundefined mult RegExp privVar privFunc populator
 -->
<!--  LocalWords:  Browserify instanceof
 -->
